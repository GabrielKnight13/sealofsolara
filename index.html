<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seal of Solara</title>
 <style>
   body { font-family: Arial, sans-serif; background: #111; color: #eee; text-align: center; }
  img { width: 420px; height: 315px; border: 2px solid #444; align-items: center;margin-bottom: 8px; opacity: 1; transition: opacity 0.6s ease-in-out; }
  button { margin: 3px; padding: 4px 8px; font-size: 12px; cursor: pointer; }
  #message { font-size: 14px; margin: 6px; color: #ffd700; min-height: 20px; }
  #inventory { margin-top: 6px; font-size: 13px; }
  #controls { margin-top: 10px; }
  #return { margin-top: 12px; display: none; }
/* Scene wrapper adapts to screen */
#scene-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 800px; /* Optional: cap width for large screens */
  margin: auto;
  padding: 0 12px;
  box-sizing: border-box;
}

/* Scene image scales naturally */
#scene {
  width: 100%;
  height: auto;
  max-height: 80vh;
  object-fit: contain;
  border: 2px solid #444;
  border-radius: 6px;
  transition: opacity 0.6s ease-in-out;
}

  /* Movement pad layout */
  .dpad {
    display: grid;
    grid-template-columns: 35px 35px 35px;
    grid-template-rows: 35px 35px;
	gap: 3px;
    justify-content: center;
    margin: 6px auto;
    
  }
	.dpad button {
	    width: 35px;
		height: 35px;
		font-size: 14px;
		background-color: #2e1f0f;       /* Match actions */
		color: #f4e9d8;                  /* Match actions */
		border: 1px solid #d4af37;
		border-radius: 4px;
		font-family: 'Cinzel', serif;   /* Match actions */
		cursor: pointer;
		transition: box-shadow 0.3s ease, transform 0.2s ease;
	}
	.dpad button:hover {
	  box-shadow: 0 0 8px #d4af37;
	  transform: scale(1.03);
	}
  .dpad .north { grid-column: 2; grid-row: 1; }
  .dpad .west  { grid-column: 1; grid-row: 2; }
  .dpad .east  { grid-column: 3; grid-row: 2; }
  .dpad .south { grid-column: 2; grid-row: 2; }

  /* Action row */
 .actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 12px 0;
  flex-wrap: wrap;
}

.actions button {
  flex: 1 1 120px;
  max-width: 140px;
  padding: 6px 12px;
  background-color: #2e1f0f;
  color: #f4e9d8;
  border: 1px solid #d4af37;
  font-size: 14px;
  font-family: 'Cinzel', serif;
  border-radius: 4px;
  cursor: pointer;
  transition: box-shadow 0.3s ease, transform 0.2s ease;
}

.actions button:hover {
  box-shadow: 0 0 8px #d4af37;
  transform: scale(1.03);
}
#message, #description {
  font-size: clamp(12px, 2vw, 16px);
  text-align: center;
  margin: 6px 0;
}
@media (max-width: 600px) {
  #scene-wrapper {
    max-width: 100%;
    padding: 0 8px;
  }

  .actions button {
    flex: 1 1 100px;
    font-size: 13px;
  }

  #scene {
    max-height: 60vh;
  }
}
</style>

</head>
<body>
  <h1>Seal of Solara</h1>
	 <div id="scene-wrapper">
  <img id="scene" src="/static/assets/forest.png" alt="Scene Image">
  <div id="message">Welcome, adventurer.</div>
  <p id="description"></p>
  <div id="controls">
    <!-- Movement pad -->
    <div class="dpad">
      <button class="north" onclick="sendAction('move', { direction: 'north' })">‚¨ÜÔ∏è</button>
      <button class="west"  onclick="sendAction('move', { direction: 'west' })">‚¨ÖÔ∏è</button>
      <button class="east"  onclick="sendAction('move', { direction: 'east' })">‚û°Ô∏è</button>
      <button class="south" onclick="sendAction('move', { direction: 'south' })">‚¨áÔ∏è</button>
    </div>

    <!-- Action buttons -->
    <div class="actions">
      <button onclick="sendAction('grab')">üß§ Grab</button>
      <button onclick="sendAction('use')">ü™Ñ Use</button>
      <button onclick="sendAction('talk')">üó£Ô∏è Talk</button>
      <button onclick="sendAction('cycle_inventory', { direction: 'next' })">üîÅ Next Item</button>
    </div>
  </div>

  <div id="inventory">Inventory: <span id="items">None</span></div>
  <div id="selected">Selected: <span id="selectedItem">None</span></div>

  <div id="return">
    <h2>‚ú® Victory!</h2>
    <button onclick="resetGame()">üè† Return to Title</button>
  </div>
  <p id="heartbeat" style="font-size:12px; color:#888;">Heartbeat: waiting...</p>
   </div>
  <script>
    async function sendAction(endpoint, payload = {}) {
      const res = await fetch(`/${endpoint}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      updateUI(data);
    }

    async function loadInventory() {
      const res = await fetch("/inventory");
      const data = await res.json();
      updateUI(data);
    }

    async function resetGame() {
      const res = await fetch("/reset", { method: "POST" });
      const data = await res.json();
      updateUI(data);
      document.getElementById("controls").style.display = "block";
      document.getElementById("return").style.display = "none";
    }

    function updateUI(data) {
      document.getElementById("description").textContent = data.description;
      document.getElementById("message").textContent = data.message;
      if (data.image) fadeScene(data.image);
      if (data.inventory) {
        document.getElementById("items").textContent = data.inventory.join(", ") || "None";
        document.getElementById("selectedItem").textContent = data.selected || "None";
      }
      if (data.type === "end") {
        document.getElementById("controls").style.display = "none";
        document.getElementById("return").style.display = "block";
      }
    }

    function fadeScene(newSrc) {
      const scene = document.getElementById("scene");
      scene.style.opacity = 0;
      setTimeout(() => {
        scene.src = newSrc;
        scene.onload = () => { scene.style.opacity = 1; };
      }, 300);
    }

    // Initial load
    loadInventory();
    // üîÑ Manual ping on page load
  fetch("/ping")
    .then(() => {
      const now = new Date().toLocaleTimeString();
      document.getElementById("heartbeat").textContent = `Heartbeat: ${now}`;
    })
    .catch(() => {
      document.getElementById("heartbeat").textContent = "Heartbeat: failed";
    });

  // üîÅ Background ping every 5 minutes
  setInterval(() => {
    fetch("/ping")
      .then(() => {
        const now = new Date().toLocaleTimeString();
        document.getElementById("heartbeat").textContent = `Heartbeat: ${now}`;
      })
      .catch(() => {
        document.getElementById("heartbeat").textContent = "Heartbeat: failed";
      });
  }, 300000); // 5 minutes
  </script>
</body>

</html>










